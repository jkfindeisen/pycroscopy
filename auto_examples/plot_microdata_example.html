

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Writing to hdf5 using the Microdata objects &mdash; pycroscopy 0.59.2 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
  

  
        <link rel="author" title="About these documents"
              href="../about.html"/>
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="pycroscopy 0.59.2 documentation" href="../index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> pycroscopy
          

          
          </a>

          
            
            
              <div class="version">
                0.59.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../about.html">Pycroscopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whats_new.html">What’s New</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_format.html">Pycroscopy Data and File Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../papers_conferences.html">Papers / Conferences</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">Examples &amp; Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#scientific-data-analysis">Scientific Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#developer-tutorials">Developer Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#user-tutorials">User Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contact.html">Contact us</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pycroscopy</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Writing to hdf5 using the Microdata objects</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/auto_examples/plot_microdata_example.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="writing-to-hdf5-using-the-microdata-objects">
<span id="sphx-glr-auto-examples-plot-microdata-example-py"></span><h1>Writing to hdf5 using the Microdata objects<a class="headerlink" href="#writing-to-hdf5-using-the-microdata-objects" title="Permalink to this headline">¶</a></h1>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Code source: Chris Smith -- cq6@ornl.gov</span>
<span class="c1"># Liscense: MIT</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pycroscopy</span> <span class="kn">as</span> <span class="nn">px</span>
</pre></div>
</div>
<p>Create some MicroDatasets and MicroDataGroups that will be written to the file.
With h5py, groups and datasets must be created from the top down,
but the Microdata objects allow us to build them in any order and link them later.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># First create some data</span>
<span class="n">data1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
<p>Now use the array to build the dataset.  This dataset will live
directly under the root of the file.  The MicroDataset class also implements the
compression and chunking parameters from h5py.Dataset.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ds_main</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">MicroDataset</span><span class="p">(</span><span class="s1">&#39;Main_Data&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data1</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>We can also create an empty dataset and write the values in later
With this method, it is neccessary to specify the dtype and maxshape kwarg parameters.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ds_empty</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">MicroDataset</span><span class="p">(</span><span class="s1">&#39;Empty_Data&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">maxshape</span><span class="o">=</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
<p>We can also create groups and add other MicroData objects as children.
If the group’s parent is not given, it will be set to root.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">data_group</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">MicroDataGroup</span><span class="p">(</span><span class="s1">&#39;Data_Group&#39;</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>

<span class="n">root_group</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">MicroDataGroup</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>

<span class="c1"># After creating the group, we then add an existing object as its child.</span>
<span class="n">data_group</span><span class="o">.</span><span class="n">addChildren</span><span class="p">([</span><span class="n">ds_empty</span><span class="p">])</span>
<span class="n">root_group</span><span class="o">.</span><span class="n">addChildren</span><span class="p">([</span><span class="n">ds_main</span><span class="p">,</span> <span class="n">data_group</span><span class="p">])</span>
</pre></div>
</div>
<p>The showTree method allows us to view the data structure before the hdf5 file is
created.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">root_group</span><span class="o">.</span><span class="n">showTree</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="o">///</span><span class="n">Main_Data</span>
<span class="o">///</span><span class="n">Data_Group</span>
<span class="o">///</span><span class="n">Data_Group</span><span class="o">/</span><span class="n">Empty_Data</span>
</pre></div>
</div>
<p>Now that we have created the objects, we can write them to an hdf5 file</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># First we specify the path to the file</span>
<span class="n">h5_path</span> <span class="o">=</span> <span class="s1">&#39;microdata_test.h5&#39;</span>

<span class="c1"># Then we use the ioHDF5 class to build the file from our objects.</span>
<span class="n">hdf</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">ioHDF5</span><span class="p">(</span><span class="n">h5_path</span><span class="p">)</span>
</pre></div>
</div>
<p>The writeData method builds the hdf5 file using the structure defined by the
MicroData objects.  It returns a list of references to all h5py objects in the
new file.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">h5_refs</span> <span class="o">=</span> <span class="n">hdf</span><span class="o">.</span><span class="n">writeData</span><span class="p">(</span><span class="n">root_group</span><span class="p">,</span> <span class="n">print_log</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># We can use these references to get the h5py dataset and group objects</span>
<span class="n">h5_main</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">getH5DsetRefs</span><span class="p">([</span><span class="s1">&#39;Main_Data&#39;</span><span class="p">],</span> <span class="n">h5_refs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">h5_empty</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">getH5DsetRefs</span><span class="p">([</span><span class="s1">&#39;Empty_Data&#39;</span><span class="p">],</span> <span class="n">h5_refs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="n">Group</span> <span class="n">already</span> <span class="n">exists</span><span class="p">:</span> <span class="o">/</span>
<span class="n">Writing</span> <span class="n">attribute</span><span class="p">:</span> <span class="n">machine_id</span> <span class="k">with</span> <span class="n">value</span><span class="p">:</span> <span class="n">PC95444</span><span class="o">.</span><span class="n">ornl</span><span class="o">.</span><span class="n">gov</span>
<span class="n">Writing</span> <span class="n">attribute</span><span class="p">:</span> <span class="n">timestamp</span> <span class="k">with</span> <span class="n">value</span><span class="p">:</span> <span class="mi">2017</span><span class="n">_12_04</span><span class="o">-</span><span class="mi">14</span><span class="n">_18_38</span>
<span class="n">Wrote</span> <span class="n">attributes</span> <span class="n">to</span> <span class="n">group</span><span class="p">:</span> <span class="o">/</span>

<span class="n">Created</span> <span class="n">Dataset</span> <span class="o">/</span><span class="n">Main_Data</span>
<span class="n">Created</span> <span class="n">Group</span> <span class="o">/</span><span class="n">Data_Group</span>
<span class="n">Writing</span> <span class="n">attribute</span><span class="p">:</span> <span class="n">machine_id</span> <span class="k">with</span> <span class="n">value</span><span class="p">:</span> <span class="n">PC95444</span><span class="o">.</span><span class="n">ornl</span><span class="o">.</span><span class="n">gov</span>
<span class="n">Writing</span> <span class="n">attribute</span><span class="p">:</span> <span class="n">timestamp</span> <span class="k">with</span> <span class="n">value</span><span class="p">:</span> <span class="mi">2017</span><span class="n">_12_04</span><span class="o">-</span><span class="mi">14</span><span class="n">_18_38</span>
<span class="n">Wrote</span> <span class="n">attributes</span> <span class="n">to</span> <span class="n">group</span> <span class="o">/</span><span class="n">Data_Group</span>

<span class="n">Created</span> <span class="n">Dataset</span> <span class="o">/</span><span class="n">Data_Group</span><span class="o">/</span><span class="n">Empty_Data</span>
<span class="n">Finished</span> <span class="n">writing</span> <span class="n">to</span> <span class="n">h5</span> <span class="n">file</span><span class="o">.</span>
<span class="n">Right</span> <span class="n">now</span> <span class="n">you</span> <span class="n">got</span> <span class="n">yourself</span> <span class="n">a</span> <span class="n">fancy</span> <span class="n">folder</span> <span class="n">structure</span><span class="o">.</span>
<span class="n">Make</span> <span class="n">sure</span> <span class="n">you</span> <span class="n">do</span> <span class="n">some</span> <span class="n">reference</span> <span class="n">linking</span> <span class="n">to</span> <span class="n">take</span> <span class="n">advantage</span> <span class="n">of</span> <span class="n">the</span> <span class="n">full</span> <span class="n">power</span> <span class="n">of</span> <span class="n">HDF5</span><span class="o">.</span>
</pre></div>
</div>
<p>Compare the data in our dataset to the original</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">h5_main</span><span class="p">[()],</span> <span class="n">data1</span><span class="p">))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="kc">True</span>
</pre></div>
</div>
<p>As mentioned above, we can now write to the Empty_Data object</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">data2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="o">*</span><span class="n">h5_empty</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">h5_empty</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">data2</span><span class="p">[:]</span>
</pre></div>
</div>
<p>Now that we are using h5py objects, we must use flush to write the data to file
after it has been altered.
We need the file object to do this.  It can be accessed as an attribute of the
hdf object.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">h5_file</span> <span class="o">=</span> <span class="n">hdf</span><span class="o">.</span><span class="n">file</span>
<span class="n">h5_file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</pre></div>
</div>
<p>Now that we are done, we should close the file so that it can be accessed elsewhere.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">h5_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">h5_path</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Total running time of the script:</strong> ( 0 minutes  0.007 seconds)</p>
<div class="sphx-glr-footer docutils container">
<div class="sphx-glr-download docutils container">
<a class="reference download internal" href="../_downloads/plot_microdata_example.py" download=""><code class="xref download docutils literal"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_microdata_example.py</span></code></a></div>
<div class="sphx-glr-download docutils container">
<a class="reference download internal" href="../_downloads/plot_microdata_example.ipynb" download=""><code class="xref download docutils literal"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_microdata_example.ipynb</span></code></a></div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.readthedocs.io">Gallery generated by Sphinx-Gallery</a></p>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Suhas Somnath, Chris Smith, Stephen Jesse, Numan Laanait.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.59.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>