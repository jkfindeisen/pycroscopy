

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tutorial 2: Writing to pycroscopy H5 files &mdash; pycroscopy 0.59.2 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
  

  
        <link rel="author" title="About these documents"
              href="../about.html"/>
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="pycroscopy 0.59.2 documentation" href="../index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> pycroscopy
          

          
          </a>

          
            
            
              <div class="version">
                0.59.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../about.html">Pycroscopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whats_new.html">What’s New</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_format.html">Pycroscopy Data and File Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../papers_conferences.html">Papers / Conferences</a></li>
<li class="toctree-l1"><a class="reference internal" href="../auto_examples/index.html">Examples &amp; Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../auto_examples/index.html#scientific-data-analysis">Scientific Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../auto_examples/index.html#developer-tutorials">Developer Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../auto_examples/index.html#user-tutorials">User Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contact.html">Contact us</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pycroscopy</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Tutorial 2: Writing to pycroscopy H5 files</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/auto_tutorials/plot_tutorial_02_writing_to_h5.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tutorial-2-writing-to-pycroscopy-h5-files">
<span id="sphx-glr-auto-tutorials-plot-tutorial-02-writing-to-h5-py"></span><h1>Tutorial 2: Writing to pycroscopy H5 files<a class="headerlink" href="#tutorial-2-writing-to-pycroscopy-h5-files" title="Permalink to this headline">¶</a></h1>
<p><strong>Suhas Somnath</strong>
8/8/2017</p>
<p>This set of tutorials will serve as examples for developing end-to-end workflows for and using pycroscopy.</p>
<p>While pycroscopy contains many popular data processing function, it may not have a function you need. Since pycroscopy
is data-centric, it is preferable to write processing results back to the same file as well.</p>
<p><strong>In this example, we will write the results of K-Means clustering (on a Scanning Tunnelling Spectroscopy (STS) dataset)
back to the file.</strong></p>
<p>K-Means clustering is a quick and simple method to determine the types of spectral responses present in the data and
their spatial occurrence.</p>
<div class="section" id="introduction">
<h2>Introduction:<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="data-structuring-and-file-format">
<h2>Data structuring and file format:<a class="headerlink" href="#data-structuring-and-file-format" title="Permalink to this headline">¶</a></h2>
<p><strong>Before proceeding with this example, we highly recommend you read about data formatting in pycroscopy as well as
reading and writing to HDF5 files.</strong></p>
<p>This bookkeeping is necessary for helping the code to understand the dimensionality and structure of the data. While
these rules may seem tedious, there are several functions and a few classes that make these tasks much easier</p>
</div>
<div class="section" id="classes-for-writing-files">
<h2>Classes for writing files<a class="headerlink" href="#classes-for-writing-files" title="Permalink to this headline">¶</a></h2>
<p>In order to deal with the numerous challenges in writing data in a consistent manner, especially during translation,
in the pycroscopy format, we developed two main classes: <strong>MicroData</strong> and <strong>ioHDF5</strong>.</p>
</div>
<div class="section" id="microdata">
<h2>MicroData<a class="headerlink" href="#microdata" title="Permalink to this headline">¶</a></h2>
<p>The abstract class MicroData is extended by <strong>MicroDataset</strong> and <strong>MicroDatagroup</strong> which are skeletal counterparts
for the h5py.Dataset and h5py.Datagroup classes respectively. These classes allow programmers to quickly and simply
set up the tree structure that needs to be written to H5 files without having to worry about the low-level HDF5
constructs or defensive programming strategies necessary for writing the H5 files. Besides facilitating the
construction of a tree structure, each of the classes have a few features specific to pycroscopy to alleviate file
writing.</p>
</div>
<div class="section" id="iohdf5">
<h2>ioHDF5<a class="headerlink" href="#iohdf5" title="Permalink to this headline">¶</a></h2>
<p>While we use <strong>h5py</strong> to read from pycroscopy files, the ioHDF5 class is used to write data to H5 files. ioHDF5
translates the tree structure described by a MicroDataGroup object and writes the contents to H5 files in a
standardized manner. As a wrapper around h5py, tt handles the low-level file I/O calls and includes defensive
programming strategies to minimize issues with writing to H5 files.</p>
</div>
<div class="section" id="why-bother-with-microdata-and-iohdf5">
<h2>Why bother with Microdata and ioHDF5?<a class="headerlink" href="#why-bother-with-microdata-and-iohdf5" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>These classes simplify the process of writing to H5 files considerably. The programmer only needs to construct
the tree structure with simple python objects such as dictionaries for parameters, numpy datasets for storing data, etc.</li>
<li>It is easy to corrupt H5 files. ioHDF5 uses defensive programming strategies to solve these problems.</li>
</ul>
<p>Translation can be challenging in many cases:</p>
<ul>
<li><p class="first">It may not be possible to read the entire data from the raw data file to memory as we did in the tutorial on
Translation</p>
<blockquote>
<div><ul class="simple">
<li>ioHDF5 allows the general tree structure and the attributes to be written before the data is populated.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Sometimes, the raw data files do not come with sufficient parameters that describe the size and shape of the data.
This makes it challenging to prepare the H5 file.</p>
<blockquote>
<div><ul class="simple">
<li>ioHDF5 allows dataets to be dataFile I/O is expensive and we don’t want to read the same raw data files multiple
times</li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Ensure python 3 compatibility:</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">unicode_literals</span>

<span class="c1"># The package for accessing files in directories, etc.:</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Warning package in case something goes wrong</span>
<span class="kn">from</span> <span class="nn">warnings</span> <span class="kn">import</span> <span class="n">warn</span>

<span class="c1"># Package for downloading online files:</span>
<span class="k">try</span><span class="p">:</span>
    <span class="c1"># This package is not part of anaconda and may need to be installed.</span>
    <span class="kn">import</span> <span class="nn">wget</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;wget not found.  Will install with pip.&#39;</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">pip</span>
    <span class="n">pip</span><span class="o">.</span><span class="n">main</span><span class="p">([</span><span class="s1">&#39;install&#39;</span><span class="p">,</span> <span class="s1">&#39;wget&#39;</span><span class="p">])</span>
    <span class="kn">import</span> <span class="nn">wget</span>

<span class="c1"># The mathematical computation package:</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="c1"># The package used for creating and manipulating HDF5 files:</span>
<span class="kn">import</span> <span class="nn">h5py</span>

<span class="c1"># Packages for plotting:</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="c1"># Package for performing k-Means clustering:</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>

<span class="c1"># Finally import pycroscopy for certain scientific analysis:</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pycroscopy</span> <span class="kn">as</span> <span class="nn">px</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;pycroscopy not found.  Will install with pip.&#39;</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">pip</span>
    <span class="n">pip</span><span class="o">.</span><span class="n">main</span><span class="p">([</span><span class="s1">&#39;install&#39;</span><span class="p">,</span> <span class="s1">&#39;pycroscopy&#39;</span><span class="p">])</span>
    <span class="kn">import</span> <span class="nn">pycroscopy</span> <span class="kn">as</span> <span class="nn">px</span>
<span class="kn">from</span> <span class="nn">pycroscopy.io.translators.omicron_asc</span> <span class="kn">import</span> <span class="n">AscTranslator</span>
</pre></div>
</div>
</div>
<div class="section" id="loading-the-dataset">
<h2>Loading the dataset<a class="headerlink" href="#loading-the-dataset" title="Permalink to this headline">¶</a></h2>
<p>We wil start by downloading the raw data file as generated by the microscope and then translate the file to a
pycroscopy H5 file.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># download the raw data file from Github:</span>
<span class="n">data_file_path</span> <span class="o">=</span> <span class="s1">&#39;temp_2.asc&#39;</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/pycroscopy/pycroscopy/master/data/STS.asc&#39;</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">data_file_path</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">data_file_path</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data_file_path</span><span class="p">,</span> <span class="n">bar</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

<span class="c1"># Translating from raw data to h5:</span>
<span class="n">tran</span> <span class="o">=</span> <span class="n">AscTranslator</span><span class="p">()</span>
<span class="n">h5_path</span> <span class="o">=</span> <span class="n">tran</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">data_file_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="reading-the-h5-dataset">
<h2>Reading the H5 dataset<a class="headerlink" href="#reading-the-h5-dataset" title="Permalink to this headline">¶</a></h2>
<p>This data is a Scanning Tunnelling Spectroscopy (STS) dataset wherein current was measured as a function of voltage
on a two dimensional grid of points. Thus, the data has three dimensions (X, Y, Bias). Note, that in pycroscopy, all
position dimensions are collapsed to the first dimension and all spectroscopic (only bias in this case) dimensions
are collapsed to the second axis of a two dimensional matrix. So, the data is represented as (position, bias)
instead.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># opening the file:</span>
<span class="n">hdf</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">ioHDF5</span><span class="p">(</span><span class="n">h5_path</span><span class="p">)</span>
<span class="n">h5_file</span> <span class="o">=</span> <span class="n">hdf</span><span class="o">.</span><span class="n">file</span>

<span class="c1"># Visualize the tree structure in the file</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Tree structure within the file:&#39;</span><span class="p">)</span>
<span class="n">px</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">print_tree</span><span class="p">(</span><span class="n">h5_file</span><span class="p">)</span>

<span class="c1"># Extracting some parameters that will be necessary later on:</span>
<span class="n">h5_meas_grp</span> <span class="o">=</span> <span class="n">h5_file</span><span class="p">[</span><span class="s1">&#39;Measurement_000&#39;</span><span class="p">]</span>
<span class="n">num_cols</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">px</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="n">h5_meas_grp</span><span class="p">,</span> <span class="s1">&#39;x-pixels&#39;</span><span class="p">))</span>
<span class="n">num_rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">px</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="n">h5_meas_grp</span><span class="p">,</span> <span class="s1">&#39;y-pixels&#39;</span><span class="p">))</span>

<span class="c1"># There are multiple ways of accessing the Raw_Data dataset. Here&#39;s one approach:</span>
<span class="n">h5_main</span> <span class="o">=</span> <span class="n">h5_meas_grp</span><span class="p">[</span><span class="s1">&#39;Channel_000/Raw_Data&#39;</span><span class="p">]</span>

<span class="c1"># Prepare the label for plots:</span>
<span class="n">y_label</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="n">h5_main</span><span class="p">,</span> <span class="s1">&#39;quantity&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; [&#39;</span> <span class="o">+</span> <span class="n">px</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="n">h5_main</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span>

<span class="c1"># Get the voltage vector that this data was acquired as a function of:</span>
<span class="n">h5_spec_vals</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">getAuxData</span><span class="p">(</span><span class="n">h5_main</span><span class="p">,</span> <span class="s1">&#39;Spectroscopic_Values&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">volt_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">h5_spec_vals</span><span class="p">[()])</span>

<span class="c1"># Get the descriptor for this</span>
<span class="n">x_label</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="n">h5_spec_vals</span><span class="p">,</span> <span class="s1">&#39;labels&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; [&#39;</span> <span class="o">+</span> <span class="n">px</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="n">h5_spec_vals</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span>

<span class="c1"># Currently, the data is within the h5 dataset. We need to read this to memory:</span>
<span class="n">data_mat</span> <span class="o">=</span> <span class="n">h5_main</span><span class="p">[()]</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Data now loaded to memory and is of shape:&#39;</span><span class="p">,</span> <span class="n">data_mat</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Data has&#39;</span><span class="p">,</span> <span class="n">num_rows</span><span class="p">,</span> <span class="s1">&#39;rows and&#39;</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">,</span> <span class="s1">&#39;columns each having a&#39;</span><span class="p">,</span>
      <span class="n">data_mat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;long measurement of&#39;</span><span class="p">,</span> <span class="n">y_label</span><span class="p">,</span><span class="s1">&#39;as a function of&#39;</span><span class="p">,</span> <span class="n">x_label</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="n">Tree</span> <span class="n">structure</span> <span class="n">within</span> <span class="n">the</span> <span class="n">file</span><span class="p">:</span>
<span class="o">/</span>
<span class="n">Measurement_000</span>
<span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000</span>
<span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000</span><span class="o">/</span><span class="n">Position_Indices</span>
<span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000</span><span class="o">/</span><span class="n">Position_Values</span>
<span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000</span><span class="o">/</span><span class="n">Raw_Data</span>
<span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000</span><span class="o">/</span><span class="n">Spectroscopic_Indices</span>
<span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000</span><span class="o">/</span><span class="n">Spectroscopic_Values</span>

<span class="n">Data</span> <span class="n">now</span> <span class="n">loaded</span> <span class="n">to</span> <span class="n">memory</span> <span class="ow">and</span> <span class="ow">is</span> <span class="n">of</span> <span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">Data</span> <span class="n">has</span> <span class="mi">100</span> <span class="n">rows</span> <span class="ow">and</span> <span class="mi">100</span> <span class="n">columns</span> <span class="n">each</span> <span class="n">having</span> <span class="n">a</span> <span class="mi">500</span> <span class="n">long</span> <span class="n">measurement</span> <span class="n">of</span> <span class="n">Current</span> <span class="p">[</span><span class="n">nA</span><span class="p">]</span> <span class="k">as</span> <span class="n">a</span> <span class="n">function</span> <span class="n">of</span> <span class="n">Bias</span> <span class="p">[</span><span class="n">V</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="performing-k-means-clustering">
<h2>Performing k-Means Clustering:<a class="headerlink" href="#performing-k-means-clustering" title="Permalink to this headline">¶</a></h2>
<p>Now that the data is loaded to memory, we can perform k-Means clustering on data_mat. As a reminder, K-Means
clustering is a quick and simple method to determine the types of spectral responses present in the data and their
spatial occurance.</p>
<p>Let us assume that we have a  <cite>P x S</cite> dataset with <cite>P</cite> positions each with spectra that are <cite>S</cite> long. When K-Means
is asked to identify <cite>k</cite> clusters, it will produce two results:
* cluster_centers: This contains the different kinds of spectral responses and is represented as a two dimensional
array of the form [cluster number, representative spectra for this cluster]. Thus this dataset will have a shape
of <cite>k x S</cite>
* labels: This provides the information about which spatial pixel belongs to which group. It will be a
1 dimensional array of size <cite>P</cite> wherein the value for each element in the array (cluster id for each pixel) will
be within <cite>[0, k)</cite></p>
<p><strong>Our goal is to write back these two datasets to the H5 file</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">num_clusters</span> <span class="o">=</span> <span class="mi">9</span>

<span class="c1"># Now, we can perform k-Means clustering:</span>
<span class="n">estimators</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">num_clusters</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">estimators</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_mat</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;K-Means Clustering performed on the dataset of shape&#39;</span><span class="p">,</span> <span class="n">data_mat</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
      <span class="s1">&#39;resulted in a cluster centers matrix of shape&#39;</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">cluster_centers_</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
      <span class="s1">&#39;and a labels array of shape&#39;</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">labels_</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">By default, the clusters identified by K-Means are NOT arranged according to their relative</span>
<span class="sd">distances to each other. Visualizing and interpreting this data is challenging. We will sort the</span>
<span class="sd">results using a handy function already in pycroscopy:</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">labels</span><span class="p">,</span> <span class="n">centroids</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">processing</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">reorder_clusters</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">labels_</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">cluster_centers_</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="n">K</span><span class="o">-</span><span class="n">Means</span> <span class="n">Clustering</span> <span class="n">performed</span> <span class="n">on</span> <span class="n">the</span> <span class="n">dataset</span> <span class="n">of</span> <span class="n">shape</span> <span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span> <span class="n">resulted</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">cluster</span> <span class="n">centers</span> <span class="n">matrix</span> <span class="n">of</span> <span class="n">shape</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span> <span class="ow">and</span> <span class="n">a</span> <span class="n">labels</span> <span class="n">array</span> <span class="n">of</span> <span class="n">shape</span> <span class="p">(</span><span class="mi">10000</span><span class="p">,)</span>
</pre></div>
</div>
</div>
<div class="section" id="visualize-the-results">
<h2>Visualize the results:<a class="headerlink" href="#visualize-the-results" title="Permalink to this headline">¶</a></h2>
<p>We will visualize both the raw results from k-Means as well as the distance-sorted results from pycroscopy.
You will notice that the sorted results are easier to understand and interpret. This is an example of the kind of
additional value that can be packed into pycroscopy wrappers on existing data analysis / processing functions.</p>
<p>A second example of value addition - The pycroscopy wrapper for Clustering handles real, complex, and compound
valued datasets seamlessly in the background.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">px</span><span class="o">.</span><span class="n">plot_utils</span><span class="o">.</span><span class="n">plot_cluster_results_together</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">labels_</span><span class="p">,</span> <span class="p">(</span><span class="n">num_rows</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">)),</span>
                                            <span class="n">results</span><span class="o">.</span><span class="n">cluster_centers_</span><span class="p">,</span> <span class="n">spec_val</span><span class="o">=</span><span class="n">volt_vec</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">inferno</span><span class="p">,</span>
                                            <span class="n">spec_label</span><span class="o">=</span><span class="n">x_label</span><span class="p">,</span> <span class="n">resp_label</span><span class="o">=</span><span class="n">y_label</span><span class="p">);</span>

<span class="n">px</span><span class="o">.</span><span class="n">plot_utils</span><span class="o">.</span><span class="n">plot_cluster_results_together</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="p">(</span><span class="n">num_rows</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">)),</span>
                                            <span class="n">centroids</span><span class="p">,</span> <span class="n">spec_val</span><span class="o">=</span><span class="n">volt_vec</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">inferno</span><span class="p">,</span>
                                            <span class="n">spec_label</span><span class="o">=</span><span class="n">x_label</span><span class="p">,</span> <span class="n">resp_label</span><span class="o">=</span><span class="n">y_label</span><span class="p">);</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><a class="first reference internal image-reference" href="../_images/sphx_glr_plot_tutorial_02_writing_to_h5_0011.png"><img alt="../_images/sphx_glr_plot_tutorial_02_writing_to_h5_0011.png" src="../_images/sphx_glr_plot_tutorial_02_writing_to_h5_0011.png" style="width: 564.0px; height: 376.0px;" /></a>
</li>
<li><a class="first reference internal image-reference" href="../_images/sphx_glr_plot_tutorial_02_writing_to_h5_0021.png"><img alt="../_images/sphx_glr_plot_tutorial_02_writing_to_h5_0021.png" src="../_images/sphx_glr_plot_tutorial_02_writing_to_h5_0021.png" style="width: 564.0px; height: 376.0px;" /></a>
</li>
</ul>
</div>
<div class="section" id="preparing-to-write-results">
<h2>Preparing to write results<a class="headerlink" href="#preparing-to-write-results" title="Permalink to this headline">¶</a></h2>
<p>The two datasets we need to write back to the H5 file are the <cite>centroids</cite> and <cite>labels</cite> matrices. Both the
<cite>centroids</cite> and <cite>labels</cite> matrices satisfy the condition to be elevated to the status of <strong>`main`</strong> datasets.
However, in order to be recognized as <strong>`main`</strong> datasets, they need the four ancillary datasets to go along with
them. Recall that the main datasets only need to store references to the ancillary datasets and that we do not
need to store copies of the same ancillary datasets if multiple main datasets use them.</p>
<p>Here, we will refer to the dataset on which K-means was performed as the <strong>`source`</strong> dataset.</p>
</div>
<div class="section" id="identifying-the-ancillary-datasets">
<h2>Identifying the ancillary datasets:<a class="headerlink" href="#identifying-the-ancillary-datasets" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first"><cite>centroids</cite>:</p>
<blockquote>
<div><ul class="simple">
<li>Spectroscopic Indices and Values: Since the <cite>source</cite> dataset and the <cite>centroids</cite> datasets both contain the
same spectral information, the <cite>centroids</cite> dataset can simply reuse the ancillary spectroscopic datasets used by
the <cite>source</cite> dataset.</li>
<li>Position Indices and Values: The <cite>centroids</cite> dataset has <cite>k</cite> instances while the <cite>source</cite> dataset has <cite>P</cite>,
so we need to create a new position indicies and a new position values dataset for <cite>centroids</cite></li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><cite>labels</cite>:</p>
<blockquote>
<div><ul class="simple">
<li>Spectroscopic Indices and Values: Unlike the <cite>source</cite> dataset that has spectra of length <cite>S</cite>, this dataset
only has a single value (cluster index) at each location. Consequently, <cite>labels</cite> needs two new ancilary datasets</li>
<li>Position Indices and Values: Since both <cite>source</cite> and <cite>labels</cite> have the same number of positions and the
positions mean the same quantities for both datasets, we can simply reuse the ancillary dataset from <cite>source</cite>
for <cite>labels</cite></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="reshape-the-matricies-to-the-correct-dimensions">
<h2>Reshape the matricies to the correct dimensions<a class="headerlink" href="#reshape-the-matricies-to-the-correct-dimensions" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Since <cite>labels</cite> is a main dataset, it needs to be two dimensional matrix of size <cite>P x 1</cite></li>
<li>The <cite>Spectroscopic</cite> ancillary datasets for <cite>labels</cite> need to be of the form <cite>dimension x points</cite>. Since the
spectroscopic axis of <cite>labels</cite> is only one deep, <cite>labels</cite> has only one spectroscopic dimension which itself has
just one point. Thus the <cite>Spectroscopic</cite> matrix should be of size <cite>1 x 1</cite></li>
<li>The <cite>centroids</cite> matrix is already of the form: <cite>position x spectra</cite>, so it does not need any reshaping</li>
<li>The <cite>Position</cite> ancillary datasets for <cite>centroids</cite> need to be of the form <cite>points x dimensions</cite> as well.</li>
</ol>
<p>In this case, <cite>centroids</cite> has <cite>k</cite> positions all in one dimension. Thus the matrix needs to be reshaped to <cite>k x 1</cite></p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ds_labels_spec_inds</span><span class="p">,</span> <span class="n">ds_labels_spec_vals</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">translators</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">build_ind_val_dsets</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Label&#39;</span><span class="p">])</span>
<span class="n">ds_cluster_inds</span><span class="p">,</span> <span class="n">ds_cluster_vals</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">translators</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">build_ind_val_dsets</span><span class="p">([</span><span class="n">centroids</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">is_spectral</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                                                               <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Cluster&#39;</span><span class="p">])</span>
<span class="n">labels_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>

<span class="c1"># Rename the datasets</span>
<span class="n">ds_labels_spec_inds</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Label_Spectroscopic_Indices&#39;</span>
<span class="n">ds_labels_spec_vals</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Label_Spectroscopic_Values&#39;</span>
<span class="n">ds_cluster_inds</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Cluster_Indices&#39;</span>
<span class="n">ds_cluster_vals</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Cluster_Values&#39;</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Spectroscopic Dataset for Labels&#39;</span><span class="p">,</span> <span class="n">ds_labels_spec_inds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Position Dataset for Centroids&#39;</span><span class="p">,</span> <span class="n">ds_cluster_inds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Centroids&#39;</span><span class="p">,</span><span class="n">centroids</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Labels&#39;</span><span class="p">,</span> <span class="n">labels_mat</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="n">Spectroscopic</span> <span class="n">Dataset</span> <span class="k">for</span> <span class="n">Labels</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">Position</span> <span class="n">Dataset</span> <span class="k">for</span> <span class="n">Centroids</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">Centroids</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">Labels</span> <span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="create-the-main-microdataset-objects">
<h2>Create the Main MicroDataset objects<a class="headerlink" href="#create-the-main-microdataset-objects" title="Permalink to this headline">¶</a></h2>
<p>Remember that it is important to either inherit or add the <cite>quantity</cite> and <cite>units</cite> attributes to each <strong>main</strong> dataset</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># The two main datasets</span>
<span class="n">ds_label_mat</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">MicroDataset</span><span class="p">(</span><span class="s1">&#39;Labels&#39;</span><span class="p">,</span> <span class="n">labels_mat</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
<span class="c1"># Adding the mandatory attributes</span>
<span class="n">ds_label_mat</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;quantity&#39;</span><span class="p">:</span> <span class="s1">&#39;Cluster ID&#39;</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;a. u.&#39;</span><span class="p">}</span>

<span class="n">ds_cluster_centroids</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">MicroDataset</span><span class="p">(</span><span class="s1">&#39;Mean_Response&#39;</span><span class="p">,</span> <span class="n">centroids</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">h5_main</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
<span class="c1"># Inhereting / copying the mandatory attributes</span>
<span class="n">px</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">copy_main_attributes</span><span class="p">(</span><span class="n">h5_main</span><span class="p">,</span> <span class="n">ds_cluster_centroids</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="create-the-group-that-will-contain-these-datasets">
<h2>Create the group that will contain these datasets<a class="headerlink" href="#create-the-group-that-will-contain-these-datasets" title="Permalink to this headline">¶</a></h2>
<p>We will be appending data to the existing h5 file and since HDF5 uses a tree structure to store information, we
would need to specify where to add the sub-tree that we are building.</p>
<p>Recall that the name of the DataGroup provides information of the operation that has been performed on the
<cite>source</cite> dataset. Therefore, we need to be careful about naming the group.</p>
<p>It is also important to add relevant information about the operation. For example, the name of our operation
is <cite>Cluster</cite> analogous to the <cite>SkLearn</cite> package organization. Thus, the name of the algorithm - <cite>k-Means</cite> needs
to be written as an attribute of the group as well.</p>
<p>Occasionaly, the same operation may be performed multiple times on the same dataset with different parameters.
In the case of K-means it may be the number of clusters. pycroscopy allows all these results to be stored instead
of being overwritten by appending an index number to the end of the group name. Thus, one could have a tree
that contains the following groups:
* Raw_Data-Cluster_000 &lt;— K-means with 9 clusters
* Raw_Data-Cluster_001 &lt;— Agglomerative clustering
* Raw_Data-Cluster_002 &lt;— K-means again with 4 clusters</p>
<p>Leaving a ‘_’ at the end of the group name will instruct ioHDF5 to look for the last instance of the same
operation being performed on the same dataset. The index will then be updated accordingly</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">source_dset_name</span> <span class="o">=</span> <span class="n">h5_main</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">operation_name</span> <span class="o">=</span> <span class="s1">&#39;Cluster&#39;</span>

<span class="n">subtree_root_path</span> <span class="o">=</span> <span class="n">h5_main</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="n">cluster_grp</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">MicroDataGroup</span><span class="p">(</span><span class="n">source_dset_name</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">operation_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="p">,</span>
                                <span class="n">subtree_root_path</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;New group to be created with name:&#39;</span><span class="p">,</span> <span class="n">cluster_grp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;This group (subtree) will be appended to the H5 file under the group:&#39;</span><span class="p">,</span> <span class="n">subtree_root_path</span><span class="p">)</span>

<span class="c1"># Making a tree structure by adding the MicroDataset objects as children of this group</span>
<span class="n">cluster_grp</span><span class="o">.</span><span class="n">addChildren</span><span class="p">([</span><span class="n">ds_label_mat</span><span class="p">,</span> <span class="n">ds_cluster_centroids</span><span class="p">,</span> <span class="n">ds_cluster_inds</span><span class="p">,</span> <span class="n">ds_cluster_vals</span><span class="p">,</span> <span class="n">ds_labels_spec_inds</span><span class="p">,</span>
                         <span class="n">ds_labels_spec_vals</span><span class="p">])</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Will write the following tree:&#39;</span><span class="p">)</span>
<span class="n">cluster_grp</span><span class="o">.</span><span class="n">showTree</span><span class="p">()</span>

<span class="n">cluster_grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;num_clusters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">num_clusters</span>
<span class="n">cluster_grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;num_samples&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h5_main</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">cluster_grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;cluster_algorithm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;KMeans&#39;</span>

<span class="c1"># Get the parameters of the KMeans object that was used and write them as attributes of the group</span>
<span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">estimators</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">cluster_grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="n">estimators</span><span class="o">.</span><span class="n">get_params</span><span class="p">()[</span><span class="n">parm</span><span class="p">]</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Writing the following attrbutes to the group:&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">at_name</span> <span class="ow">in</span> <span class="n">cluster_grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">at_name</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">cluster_grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">at_name</span><span class="p">])</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="n">New</span> <span class="n">group</span> <span class="n">to</span> <span class="n">be</span> <span class="n">created</span> <span class="k">with</span> <span class="n">name</span><span class="p">:</span> <span class="n">Raw_Data</span><span class="o">-</span><span class="n">Cluster_</span>
<span class="n">This</span> <span class="n">group</span> <span class="p">(</span><span class="n">subtree</span><span class="p">)</span> <span class="n">will</span> <span class="n">be</span> <span class="n">appended</span> <span class="n">to</span> <span class="n">the</span> <span class="n">H5</span> <span class="n">file</span> <span class="n">under</span> <span class="n">the</span> <span class="n">group</span><span class="p">:</span> <span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000</span>

<span class="n">Will</span> <span class="n">write</span> <span class="n">the</span> <span class="n">following</span> <span class="n">tree</span><span class="p">:</span>
<span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000Raw_Data</span><span class="o">-</span><span class="n">Cluster_</span><span class="o">/</span><span class="n">Labels</span>
<span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000Raw_Data</span><span class="o">-</span><span class="n">Cluster_</span><span class="o">/</span><span class="n">Mean_Response</span>
<span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000Raw_Data</span><span class="o">-</span><span class="n">Cluster_</span><span class="o">/</span><span class="n">Cluster_Indices</span>
<span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000Raw_Data</span><span class="o">-</span><span class="n">Cluster_</span><span class="o">/</span><span class="n">Cluster_Values</span>
<span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000Raw_Data</span><span class="o">-</span><span class="n">Cluster_</span><span class="o">/</span><span class="n">Label_Spectroscopic_Indices</span>
<span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000Raw_Data</span><span class="o">-</span><span class="n">Cluster_</span><span class="o">/</span><span class="n">Label_Spectroscopic_Values</span>

<span class="n">Writing</span> <span class="n">the</span> <span class="n">following</span> <span class="n">attrbutes</span> <span class="n">to</span> <span class="n">the</span> <span class="n">group</span><span class="p">:</span>
<span class="n">machine_id</span> <span class="p">:</span> <span class="n">travis</span><span class="o">-</span><span class="n">job</span><span class="o">-</span><span class="mi">77</span><span class="n">b33b59</span><span class="o">-</span><span class="mi">9</span><span class="n">b94</span><span class="o">-</span><span class="mi">4313</span><span class="o">-</span><span class="n">a9a0</span><span class="o">-</span><span class="mf">89353527e674</span>
<span class="n">timestamp</span> <span class="p">:</span> <span class="mi">2017</span><span class="n">_12_13</span><span class="o">-</span><span class="mi">22</span><span class="n">_01_29</span>
<span class="n">num_clusters</span> <span class="p">:</span> <span class="mi">9</span>
<span class="n">num_samples</span> <span class="p">:</span> <span class="mi">10000</span>
<span class="n">cluster_algorithm</span> <span class="p">:</span> <span class="n">KMeans</span>
<span class="n">algorithm</span> <span class="p">:</span> <span class="n">auto</span>
<span class="n">copy_x</span> <span class="p">:</span> <span class="kc">True</span>
<span class="n">init</span> <span class="p">:</span> <span class="n">k</span><span class="o">-</span><span class="n">means</span><span class="o">++</span>
<span class="n">max_iter</span> <span class="p">:</span> <span class="mi">300</span>
<span class="n">n_clusters</span> <span class="p">:</span> <span class="mi">9</span>
<span class="n">n_init</span> <span class="p">:</span> <span class="mi">10</span>
<span class="n">n_jobs</span> <span class="p">:</span> <span class="mi">1</span>
<span class="n">precompute_distances</span> <span class="p">:</span> <span class="n">auto</span>
<span class="n">random_state</span> <span class="p">:</span> <span class="kc">None</span>
<span class="n">tol</span> <span class="p">:</span> <span class="mf">0.0001</span>
<span class="n">verbose</span> <span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="write-to-h5-and-access-the-written-objects">
<h2>Write to H5 and access the written objects<a class="headerlink" href="#write-to-h5-and-access-the-written-objects" title="Permalink to this headline">¶</a></h2>
<p>Once the tree is prepared (previous cell), ioHDF5 will handle all the file writing.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">h5_clust_refs</span> <span class="o">=</span> <span class="n">hdf</span><span class="o">.</span><span class="n">writeData</span><span class="p">(</span><span class="n">cluster_grp</span><span class="p">,</span> <span class="n">print_log</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">h5_labels</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">getH5DsetRefs</span><span class="p">([</span><span class="s1">&#39;Labels&#39;</span><span class="p">],</span> <span class="n">h5_clust_refs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">h5_centroids</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">getH5DsetRefs</span><span class="p">([</span><span class="s1">&#39;Mean_Response&#39;</span><span class="p">],</span> <span class="n">h5_clust_refs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">h5_clust_inds</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">getH5DsetRefs</span><span class="p">([</span><span class="s1">&#39;Cluster_Indices&#39;</span><span class="p">],</span> <span class="n">h5_clust_refs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">h5_clust_vals</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">getH5DsetRefs</span><span class="p">([</span><span class="s1">&#39;Cluster_Values&#39;</span><span class="p">],</span> <span class="n">h5_clust_refs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">h5_label_inds</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">getH5DsetRefs</span><span class="p">([</span><span class="s1">&#39;Label_Spectroscopic_Indices&#39;</span><span class="p">],</span> <span class="n">h5_clust_refs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">h5_label_vals</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">getH5DsetRefs</span><span class="p">([</span><span class="s1">&#39;Label_Spectroscopic_Values&#39;</span><span class="p">],</span> <span class="n">h5_clust_refs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="n">Created</span> <span class="n">group</span> <span class="o">/</span><span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000</span><span class="o">/</span><span class="n">Raw_Data</span><span class="o">-</span><span class="n">Cluster_000</span>
<span class="n">Writing</span> <span class="n">attribute</span><span class="p">:</span> <span class="n">machine_id</span> <span class="k">with</span> <span class="n">value</span><span class="p">:</span> <span class="n">travis</span><span class="o">-</span><span class="n">job</span><span class="o">-</span><span class="mi">77</span><span class="n">b33b59</span><span class="o">-</span><span class="mi">9</span><span class="n">b94</span><span class="o">-</span><span class="mi">4313</span><span class="o">-</span><span class="n">a9a0</span><span class="o">-</span><span class="mf">89353527e674</span>
<span class="n">Writing</span> <span class="n">attribute</span><span class="p">:</span> <span class="n">timestamp</span> <span class="k">with</span> <span class="n">value</span><span class="p">:</span> <span class="mi">2017</span><span class="n">_12_13</span><span class="o">-</span><span class="mi">22</span><span class="n">_01_29</span>
<span class="n">Writing</span> <span class="n">attribute</span><span class="p">:</span> <span class="n">num_clusters</span> <span class="k">with</span> <span class="n">value</span><span class="p">:</span> <span class="mi">9</span>
<span class="n">Writing</span> <span class="n">attribute</span><span class="p">:</span> <span class="n">num_samples</span> <span class="k">with</span> <span class="n">value</span><span class="p">:</span> <span class="mi">10000</span>
<span class="n">Writing</span> <span class="n">attribute</span><span class="p">:</span> <span class="n">cluster_algorithm</span> <span class="k">with</span> <span class="n">value</span><span class="p">:</span> <span class="n">KMeans</span>
<span class="n">Writing</span> <span class="n">attribute</span><span class="p">:</span> <span class="n">algorithm</span> <span class="k">with</span> <span class="n">value</span><span class="p">:</span> <span class="n">auto</span>
<span class="n">Writing</span> <span class="n">attribute</span><span class="p">:</span> <span class="n">copy_x</span> <span class="k">with</span> <span class="n">value</span><span class="p">:</span> <span class="kc">True</span>
<span class="n">Writing</span> <span class="n">attribute</span><span class="p">:</span> <span class="n">init</span> <span class="k">with</span> <span class="n">value</span><span class="p">:</span> <span class="n">k</span><span class="o">-</span><span class="n">means</span><span class="o">++</span>
<span class="n">Writing</span> <span class="n">attribute</span><span class="p">:</span> <span class="n">max_iter</span> <span class="k">with</span> <span class="n">value</span><span class="p">:</span> <span class="mi">300</span>
<span class="n">Writing</span> <span class="n">attribute</span><span class="p">:</span> <span class="n">n_clusters</span> <span class="k">with</span> <span class="n">value</span><span class="p">:</span> <span class="mi">9</span>
<span class="n">Writing</span> <span class="n">attribute</span><span class="p">:</span> <span class="n">n_init</span> <span class="k">with</span> <span class="n">value</span><span class="p">:</span> <span class="mi">10</span>
<span class="n">Writing</span> <span class="n">attribute</span><span class="p">:</span> <span class="n">n_jobs</span> <span class="k">with</span> <span class="n">value</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">Writing</span> <span class="n">attribute</span><span class="p">:</span> <span class="n">precompute_distances</span> <span class="k">with</span> <span class="n">value</span><span class="p">:</span> <span class="n">auto</span>
<span class="n">Writing</span> <span class="n">attribute</span><span class="p">:</span> <span class="n">tol</span> <span class="k">with</span> <span class="n">value</span><span class="p">:</span> <span class="mf">0.0001</span>
<span class="n">Writing</span> <span class="n">attribute</span><span class="p">:</span> <span class="n">verbose</span> <span class="k">with</span> <span class="n">value</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Wrote</span> <span class="n">attributes</span> <span class="n">to</span> <span class="n">group</span><span class="p">:</span> <span class="n">Raw_Data</span><span class="o">-</span><span class="n">Cluster_000</span>

<span class="n">Created</span> <span class="n">Dataset</span> <span class="o">/</span><span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000</span><span class="o">/</span><span class="n">Raw_Data</span><span class="o">-</span><span class="n">Cluster_000</span><span class="o">/</span><span class="n">Labels</span>
<span class="n">Writing</span> <span class="n">attribute</span><span class="p">:</span> <span class="n">quantity</span> <span class="k">with</span> <span class="n">value</span><span class="p">:</span> <span class="n">Cluster</span> <span class="n">ID</span>
<span class="n">Wrote</span> <span class="n">Attributes</span> <span class="n">of</span> <span class="n">Dataset</span> <span class="n">Labels</span>

<span class="n">Writing</span> <span class="n">attribute</span><span class="p">:</span> <span class="n">units</span> <span class="k">with</span> <span class="n">value</span><span class="p">:</span> <span class="n">a</span><span class="o">.</span> <span class="n">u</span><span class="o">.</span>
<span class="n">Wrote</span> <span class="n">Attributes</span> <span class="n">of</span> <span class="n">Dataset</span> <span class="n">Labels</span>

<span class="n">Created</span> <span class="n">Dataset</span> <span class="o">/</span><span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000</span><span class="o">/</span><span class="n">Raw_Data</span><span class="o">-</span><span class="n">Cluster_000</span><span class="o">/</span><span class="n">Mean_Response</span>
<span class="n">Writing</span> <span class="n">attribute</span><span class="p">:</span> <span class="n">quantity</span> <span class="k">with</span> <span class="n">value</span><span class="p">:</span> <span class="n">Current</span>
<span class="n">Wrote</span> <span class="n">Attributes</span> <span class="n">of</span> <span class="n">Dataset</span> <span class="n">Mean_Response</span>

<span class="n">Writing</span> <span class="n">attribute</span><span class="p">:</span> <span class="n">units</span> <span class="k">with</span> <span class="n">value</span><span class="p">:</span> <span class="n">nA</span>
<span class="n">Wrote</span> <span class="n">Attributes</span> <span class="n">of</span> <span class="n">Dataset</span> <span class="n">Mean_Response</span>

<span class="n">Created</span> <span class="n">Dataset</span> <span class="o">/</span><span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000</span><span class="o">/</span><span class="n">Raw_Data</span><span class="o">-</span><span class="n">Cluster_000</span><span class="o">/</span><span class="n">Cluster_Indices</span>
<span class="n">Starting</span> <span class="n">to</span> <span class="n">write</span> <span class="n">Region</span> <span class="n">References</span> <span class="n">to</span> <span class="n">Dataset</span> <span class="o">/</span><span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000</span><span class="o">/</span><span class="n">Raw_Data</span><span class="o">-</span><span class="n">Cluster_000</span><span class="o">/</span><span class="n">Cluster_Indices</span> <span class="n">of</span> <span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">About</span> <span class="n">to</span> <span class="n">write</span> <span class="n">region</span> <span class="n">reference</span><span class="p">:</span> <span class="n">Cluster</span> <span class="p">:</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span class="n">Wrote</span> <span class="n">Region</span> <span class="n">Reference</span><span class="p">:</span><span class="n">Cluster</span>
<span class="n">Writing</span> <span class="n">header</span> <span class="n">attributes</span><span class="p">:</span> <span class="n">labels</span>
<span class="n">Wrote</span> <span class="n">Region</span> <span class="n">References</span> <span class="n">of</span> <span class="n">Dataset</span> <span class="n">Cluster_Indices</span>
<span class="n">Created</span> <span class="n">Dataset</span> <span class="o">/</span><span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000</span><span class="o">/</span><span class="n">Raw_Data</span><span class="o">-</span><span class="n">Cluster_000</span><span class="o">/</span><span class="n">Cluster_Values</span>
<span class="n">Starting</span> <span class="n">to</span> <span class="n">write</span> <span class="n">Region</span> <span class="n">References</span> <span class="n">to</span> <span class="n">Dataset</span> <span class="o">/</span><span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000</span><span class="o">/</span><span class="n">Raw_Data</span><span class="o">-</span><span class="n">Cluster_000</span><span class="o">/</span><span class="n">Cluster_Values</span> <span class="n">of</span> <span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">About</span> <span class="n">to</span> <span class="n">write</span> <span class="n">region</span> <span class="n">reference</span><span class="p">:</span> <span class="n">Cluster</span> <span class="p">:</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span class="n">Wrote</span> <span class="n">Region</span> <span class="n">Reference</span><span class="p">:</span><span class="n">Cluster</span>
<span class="n">Writing</span> <span class="n">header</span> <span class="n">attributes</span><span class="p">:</span> <span class="n">labels</span>
<span class="n">Wrote</span> <span class="n">Region</span> <span class="n">References</span> <span class="n">of</span> <span class="n">Dataset</span> <span class="n">Cluster_Values</span>
<span class="n">Created</span> <span class="n">Dataset</span> <span class="o">/</span><span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000</span><span class="o">/</span><span class="n">Raw_Data</span><span class="o">-</span><span class="n">Cluster_000</span><span class="o">/</span><span class="n">Label_Spectroscopic_Indices</span>
<span class="n">Starting</span> <span class="n">to</span> <span class="n">write</span> <span class="n">Region</span> <span class="n">References</span> <span class="n">to</span> <span class="n">Dataset</span> <span class="o">/</span><span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000</span><span class="o">/</span><span class="n">Raw_Data</span><span class="o">-</span><span class="n">Cluster_000</span><span class="o">/</span><span class="n">Label_Spectroscopic_Indices</span> <span class="n">of</span> <span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">About</span> <span class="n">to</span> <span class="n">write</span> <span class="n">region</span> <span class="n">reference</span><span class="p">:</span> <span class="n">Label</span> <span class="p">:</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span class="n">Wrote</span> <span class="n">Region</span> <span class="n">Reference</span><span class="p">:</span><span class="n">Label</span>
<span class="n">Writing</span> <span class="n">header</span> <span class="n">attributes</span><span class="p">:</span> <span class="n">labels</span>
<span class="n">Wrote</span> <span class="n">Region</span> <span class="n">References</span> <span class="n">of</span> <span class="n">Dataset</span> <span class="n">Label_Spectroscopic_Indices</span>
<span class="n">Created</span> <span class="n">Dataset</span> <span class="o">/</span><span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000</span><span class="o">/</span><span class="n">Raw_Data</span><span class="o">-</span><span class="n">Cluster_000</span><span class="o">/</span><span class="n">Label_Spectroscopic_Values</span>
<span class="n">Starting</span> <span class="n">to</span> <span class="n">write</span> <span class="n">Region</span> <span class="n">References</span> <span class="n">to</span> <span class="n">Dataset</span> <span class="o">/</span><span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000</span><span class="o">/</span><span class="n">Raw_Data</span><span class="o">-</span><span class="n">Cluster_000</span><span class="o">/</span><span class="n">Label_Spectroscopic_Values</span> <span class="n">of</span> <span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">About</span> <span class="n">to</span> <span class="n">write</span> <span class="n">region</span> <span class="n">reference</span><span class="p">:</span> <span class="n">Label</span> <span class="p">:</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span class="n">Wrote</span> <span class="n">Region</span> <span class="n">Reference</span><span class="p">:</span><span class="n">Label</span>
<span class="n">Writing</span> <span class="n">header</span> <span class="n">attributes</span><span class="p">:</span> <span class="n">labels</span>
<span class="n">Wrote</span> <span class="n">Region</span> <span class="n">References</span> <span class="n">of</span> <span class="n">Dataset</span> <span class="n">Label_Spectroscopic_Values</span>
<span class="n">Finished</span> <span class="n">writing</span> <span class="n">to</span> <span class="n">h5</span> <span class="n">file</span><span class="o">.</span>
<span class="n">Right</span> <span class="n">now</span> <span class="n">you</span> <span class="n">got</span> <span class="n">yourself</span> <span class="n">a</span> <span class="n">fancy</span> <span class="n">folder</span> <span class="n">structure</span><span class="o">.</span>
<span class="n">Make</span> <span class="n">sure</span> <span class="n">you</span> <span class="n">do</span> <span class="n">some</span> <span class="n">reference</span> <span class="n">linking</span> <span class="n">to</span> <span class="n">take</span> <span class="n">advantage</span> <span class="n">of</span> <span class="n">the</span> <span class="n">full</span> <span class="n">power</span> <span class="n">of</span> <span class="n">HDF5</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="look-at-the-h5-file-contents-now">
<h2>Look at the H5 file contents now<a class="headerlink" href="#look-at-the-h5-file-contents-now" title="Permalink to this headline">¶</a></h2>
<p>Compare this tree with the one printed earlier. The new group and datasets should be apparent</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">px</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">print_tree</span><span class="p">(</span><span class="n">h5_file</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="o">/</span>
<span class="n">Measurement_000</span>
<span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000</span>
<span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000</span><span class="o">/</span><span class="n">Position_Indices</span>
<span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000</span><span class="o">/</span><span class="n">Position_Values</span>
<span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000</span><span class="o">/</span><span class="n">Raw_Data</span>
<span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000</span><span class="o">/</span><span class="n">Raw_Data</span><span class="o">-</span><span class="n">Cluster_000</span>
<span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000</span><span class="o">/</span><span class="n">Raw_Data</span><span class="o">-</span><span class="n">Cluster_000</span><span class="o">/</span><span class="n">Cluster_Indices</span>
<span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000</span><span class="o">/</span><span class="n">Raw_Data</span><span class="o">-</span><span class="n">Cluster_000</span><span class="o">/</span><span class="n">Cluster_Values</span>
<span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000</span><span class="o">/</span><span class="n">Raw_Data</span><span class="o">-</span><span class="n">Cluster_000</span><span class="o">/</span><span class="n">Label_Spectroscopic_Indices</span>
<span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000</span><span class="o">/</span><span class="n">Raw_Data</span><span class="o">-</span><span class="n">Cluster_000</span><span class="o">/</span><span class="n">Label_Spectroscopic_Values</span>
<span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000</span><span class="o">/</span><span class="n">Raw_Data</span><span class="o">-</span><span class="n">Cluster_000</span><span class="o">/</span><span class="n">Labels</span>
<span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000</span><span class="o">/</span><span class="n">Raw_Data</span><span class="o">-</span><span class="n">Cluster_000</span><span class="o">/</span><span class="n">Mean_Response</span>
<span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000</span><span class="o">/</span><span class="n">Spectroscopic_Indices</span>
<span class="n">Measurement_000</span><span class="o">/</span><span class="n">Channel_000</span><span class="o">/</span><span class="n">Spectroscopic_Values</span>
</pre></div>
</div>
</div>
<div class="section" id="make-centroids-and-labels-main-datasets">
<h2>Make <cite>centroids</cite> and <cite>labels</cite> -&gt; <cite>main</cite> datasets<a class="headerlink" href="#make-centroids-and-labels-main-datasets" title="Permalink to this headline">¶</a></h2>
<p>We elevate the status of these datasets by linking them to the four ancillary datasets. This part is also made
rather easy by a few pycroscopy functions.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># we already got the reference to the spectroscopic values in the first few cells</span>
<span class="n">h5_spec_inds</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">getAuxData</span><span class="p">(</span><span class="n">h5_main</span><span class="p">,</span> <span class="s1">&#39;Spectroscopic_Indices&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">px</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">checkAndLinkAncillary</span><span class="p">(</span><span class="n">h5_labels</span><span class="p">,</span>
                      <span class="p">[</span><span class="s1">&#39;Position_Indices&#39;</span><span class="p">,</span> <span class="s1">&#39;Position_Values&#39;</span><span class="p">],</span>
                      <span class="n">h5_main</span><span class="o">=</span><span class="n">h5_main</span><span class="p">)</span>
<span class="n">px</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">checkAndLinkAncillary</span><span class="p">(</span><span class="n">h5_labels</span><span class="p">,</span>
                      <span class="p">[</span><span class="s1">&#39;Spectroscopic_Indices&#39;</span><span class="p">,</span> <span class="s1">&#39;Spectroscopic_Values&#39;</span><span class="p">],</span>
                      <span class="n">anc_refs</span><span class="o">=</span><span class="p">[</span><span class="n">h5_label_inds</span><span class="p">,</span> <span class="n">h5_label_vals</span><span class="p">])</span>

<span class="n">px</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">checkAndLinkAncillary</span><span class="p">(</span><span class="n">h5_centroids</span><span class="p">,</span>
                      <span class="p">[</span><span class="s1">&#39;Spectroscopic_Indices&#39;</span><span class="p">,</span> <span class="s1">&#39;Spectroscopic_Values&#39;</span><span class="p">],</span>
                      <span class="n">anc_refs</span><span class="o">=</span><span class="p">[</span><span class="n">h5_spec_inds</span><span class="p">,</span> <span class="n">h5_spec_vals</span><span class="p">])</span>

<span class="n">px</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">checkAndLinkAncillary</span><span class="p">(</span><span class="n">h5_centroids</span><span class="p">,</span>
                      <span class="p">[</span><span class="s1">&#39;Position_Indices&#39;</span><span class="p">,</span> <span class="s1">&#39;Position_Values&#39;</span><span class="p">],</span>
                      <span class="n">anc_refs</span><span class="o">=</span><span class="p">[</span><span class="n">h5_clust_inds</span><span class="p">,</span> <span class="n">h5_clust_vals</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="why-bother-with-all-this">
<h2>Why bother with all this?<a class="headerlink" href="#why-bother-with-all-this" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Though long, this simple file writing procedure needs to be written once for a given data analysis / processing tool</li>
<li>The general nature of this Clustering algorithm facilitates the application to several other datasets
regardless of their origin</li>
<li>Once the data is written in the pycroscopy format, it is possible to apply other data analytics operations
to the datasets with a single line</li>
<li>Generalized versions of visualization algorithms can be written to visualize clustering results quickly.</li>
</ul>
<p>Here is an example of very quick visualization with effectively just a single parameter - the group containing
clustering results. The ancillary datasets linked to <cite>labels</cite> and <cite>centroids</cite> instructed the code about the
spatial and spectroscopic dimensionality and enabled it to automatically render the plots below</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">px</span><span class="o">.</span><span class="n">plot_utils</span><span class="o">.</span><span class="n">plot_cluster_h5_group</span><span class="p">(</span><span class="n">h5_labels</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_tutorial_02_writing_to_h5_0031.png" class="align-center" src="../_images/sphx_glr_plot_tutorial_02_writing_to_h5_0031.png" />
</div>
<div class="section" id="cleanup">
<h2>Cleanup<a class="headerlink" href="#cleanup" title="Permalink to this headline">¶</a></h2>
<p>Deletes the temporary files created in the example</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">data_file_path</span><span class="p">)</span>
<span class="n">hdf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">h5_path</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Total running time of the script:</strong> ( 0 minutes  10.253 seconds)</p>
<div class="sphx-glr-footer docutils container">
<div class="sphx-glr-download docutils container">
<a class="reference download internal" href="../_downloads/plot_tutorial_02_writing_to_h51.py" download=""><code class="xref download docutils literal"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_tutorial_02_writing_to_h5.py</span></code></a></div>
<div class="sphx-glr-download docutils container">
<a class="reference download internal" href="../_downloads/plot_tutorial_02_writing_to_h51.ipynb" download=""><code class="xref download docutils literal"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_tutorial_02_writing_to_h5.ipynb</span></code></a></div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.readthedocs.io">Gallery generated by Sphinx-Gallery</a></p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Suhas Somnath, Chris Smith, Stephen Jesse, Numan Laanait.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.59.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>